<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Validador de Jornadas</title>
  <meta name="color-scheme" content="dark light">
  <link rel="stylesheet" href="css/style.css">
  <!--
    Validador de Jornadas
    Regras aplicadas: baliza < 5h; interjornada ≥ 11h; limite 10h por jornada.
    Data de referência das regras: 27/08/2025.
    Importante: Políticas internas e interpretações podem mudar ao longo do tempo.
    Esta ferramenta é um apoio operacional; valide com seu coordenador/gestor e RH antes de decisões formais.
  -->
</head>
<body>
  <!-- Overlay de loading -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="spinner" aria-label="Analisando..."></div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <div class="container">
    <header>
      <div class="header-row">
        <div class="title">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M4 4h16v6H4zM4 14h10v6H4z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round" />
            <path d="M20 14h-4v6h4v-6z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round" />
          </svg>
          <h1>Validador de Jornadas</h1>
        </div>
        <button class="btn secondary" id="toggleTheme" type="button">
          <span class="ico"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></span>
          <span class="label">Tema escuro</span>
        </button>
      </div>
      <p>Informe intervalos (Entrada → Saída) com data e hora. A ferramenta agrupa por jornada,
        aplica <b>baliza</b> (&lt; 5h), verifica <b>interjornada</b> (≥ 11h) e o limite de <b>10h</b> por jornada.</p>
    </header>

    <section class="grid">
      <!-- Entrada -->
      <div class="card">
        <label>Intervalos de trabalho</label>
        <div id="rows"></div>
        <div class="buttons" style="margin-top:8px">
          <button class="btn" id="add" type="button">
            <span class="ico"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 5v14M5 12h14"/></svg></span>Adicionar intervalo
          </button>
          <button class="btn secondary" id="demo" type="button">
            <span class="ico"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M5 13l4 4L19 7"/></svg></span>Carregar exemplo
          </button>
          <button class="btn secondary" id="clear" type="button">
            <span class="ico"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 6h18M8 6v12m8-12v12M5 6l1-3h12l1 3"/></svg></span>Limpar
          </button>
        </div>
        <hr style="border:none; border-top:1px solid var(--border); margin:14px 0">
        <div class="toolbar">
          <div class="buttons">
            <button class="btn" id="analyze" type="button">
              <span class="ico"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M5 12h3m4 0h7M5 19h14M5 5h14"/></svg></span>Analisar
            </button>
            <button class="btn secondary" id="save" type="button">
              <span class="ico"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 17v-6m0 0l-3 3m3-3l3 3M5 7h14"/></svg></span>Salvar local
            </button>
            <button class="btn secondary" id="load" type="button">
              <span class="ico"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 7v6m0 0l3-3m-3 3l-3-3M5 17h14"/></svg></span>Carregar local
            </button>
          </div>
        </div>
        <p class="footer">
          Regras: <span class="kbd">baliza &lt; 5h</span> mantém jornada; <span class="kbd">gap ≥ 5h</span> inicia nova
          (requer <span class="kbd">interjornada ≥ 11h</span>); soma por jornada ≤ <span class="kbd">10h</span>.
        </p>
      </div>

      <!-- Regras -->
      <div class="card" id="regras">
        <label>Regras aplicadas</label>
        <ul style="margin:0 0 12px 16px; padding:0; color:var(--muted)">
          <li><b>Baliza (&lt; 5h)</b>: mantém os intervalos na <em>mesma</em> jornada.</li>
          <li><b>Novo início (&ge; 5h)</b>: cria nova jornada; entre jornadas, precisa <b>interjornada (&ge; 11h)</b>.</li>
          <li><b>Limite de carga</b>: cada jornada pode somar no máximo <b>10h</b> trabalhadas.</li>
        </ul>
        <details>
          <summary>Como funciona a análise?</summary>
          <div class="seglist">
            1) Ordena intervalos. 2) Constrói a jornada atual somando trabalho. 3) Se o próximo início ocorrer &lt; 5h
            após o último fim, mantém (baliza); senão, inicia nova e confere interjornada. 4) Marca violações.
          </div>
        </details>
      </div>
    </section>

    <!-- Exportar / Importar -->
    <section class="card" id="exports" style="margin-top:16px;">
      <div class="buttons">
        <button class="btn secondary" id="exportJ" type="button">
          <span class="ico"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"/><path d="M7 11l5 5 5-5"/><path d="M12 4v12"/></svg></span>
          Exportar CSV (Jornadas)
        </button>
        <button class="btn secondary" id="exportS" type="button">
          <span class="ico"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"/><path d="M7 11l5 5 5-5"/><path d="M12 4v12"/></svg></span>
          Exportar CSV (Segmentos)
        </button>
        <button class="btn secondary" id="exportJSON" type="button">
          <span class="ico"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 9l-3 3 3 3M16 9l3 3-3 3"/></svg></span>
          Exportar JSON
        </button>
        <!-- Import JSON como botão + input oculto -->
        <button class="btn secondary" id="importBtn" type="button">
          <span class="ico"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 7v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7"/><path d="M7 13l5-5 5 5"/><path d="M12 19V8"/></svg></span>
          Importar JSON
        </button>
        <input id="fileJSON" type="file" accept="application/json" hidden>
      </div>
    </section>

    <!-- Resultados -->
    <section class="card" id="output" style="display:none; margin-top:16px">
      <div class="toolbar">
        <div class="chips" id="summary"></div>
        <div class="muted">Fuso do navegador: <span id="tz" class="kbd"></span></div>
      </div>
      <table id="tbl">
        <thead>
          <tr>
            <th>#</th>
            <th>Baliza</th>
            <th>Janela da jornada</th>
            <th class="right">Total (horas)</th>
            <th>Validações de regra</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <p class="footer">Dica: clique em “Detalhes” para ver os intervalos de cada jornada.</p>
      <div class="footer" style="margin-top:8px">
        <strong>Aviso:</strong> esta ferramenta aplica as regras descritas acima conforme entendimento em 27/08/2025.
        Políticas internas e interpretações podem mudar ao longo do tempo. Use como apoio e <b>valide sempre</b> com seu
        coordenador/gestor e o RH antes de decisões formais.
      </div>
    </section>
  </div>

  <script src="js/script.js"></script>
</body>
</html>
